{
  "version": 3,
  "sources": ["../src/storage.ts", "../src/background.ts"],
  "sourcesContent": ["// Storage service for workspace-specific data\r\n// Handles per-workspace bookmarks, tabs, settings, and history\r\n\r\nexport interface Bookmark {\r\n  id: string;\r\n  title: string;\r\n  url: string;\r\n  favicon?: string;\r\n  position?: number; // For drag-and-drop ordering (legacy)\r\n  // Snap-to-grid layout (Phase 3 will use this)\r\n  gridRow?: number;\r\n  gridCol?: number;\r\n}\r\n\r\nexport interface HistoryEntry {\r\n  id: string;\r\n  url: string;\r\n  title?: string;\r\n  favicon?: string;\r\n  visitedAt: number;\r\n  tabId?: number;\r\n}\r\n\r\nexport interface Credential {\r\n  id: string;\r\n  url: string;\r\n  username: string;\r\n  password: string;\r\n  note?: string;\r\n  createdAt: number;\r\n  updatedAt: number;\r\n  lastUsedAt?: number;\r\n}\r\n\r\n/** Minimal tab info we persist; full Tab objects don't serialize reliably to chrome.storage */\r\nexport interface ClosedTabInfo {\r\n  url: string;\r\n  title?: string;\r\n}\r\n\r\nexport interface Workspace {\r\n  id: string;\r\n  name: string;\r\n  icon?: string; // Icon URL or preset identifier\r\n  active: boolean;\r\n  bookmarks: Bookmark[];\r\n  openTabs: chrome.tabs.Tab[];\r\n  closedTabs: ClosedTabInfo[]; // Remembered tabs when browser closes (plain objects for reliable storage)\r\n  activeTabUrl?: string; // URL of the last focused tab in this workspace (for restore)\r\n  settings: WorkspaceSettings;\r\n   // Per-workspace browsing history (tracked while this workspace is active)\r\n  history?: HistoryEntry[];\r\n  // Per-workspace stored credentials (Phase 5 will use this)\r\n  credentials?: Credential[];\r\n  createdAt: number;\r\n  updatedAt: number;\r\n}\r\n\r\nexport interface WorkspaceSettings {\r\n  // Panel appearance\r\n  roundedCorners: boolean;\r\n  marginFromSide: number; // pixels\r\n  marginTop: number; // pixels\r\n  marginBottom: number; // pixels\r\n  width: number; // pixels (40-80px for sidebar)\r\n  borderRadius: number; // pixels for panel border radius\r\n  iconBorderRadius: number; // pixels for icon border radius\r\n  position: 'left' | 'right'; // sidebar position\r\n  alignment: 'top' | 'bottom'; // bookmark alignment\r\n  \r\n  // Theme/Colors\r\n  backgroundColor: string; // panel background color\r\n  iconBackgroundColor: string; // icon background color\r\n  iconTextColor: string; // icon text color\r\n  borderColor: string; // border color\r\n  accentColor: string; // accent color for highlights, hover states, etc.\r\n  themeId?: string; // ID of selected theme (if using a theme)\r\n  customThemes?: CustomTheme[]; // User-defined custom themes\r\n  iconPackId?: string; // ID of selected icon pack\r\n  \r\n  // Panel behavior\r\n  mode: 'fixed' | 'hovering';\r\n  collapsible: boolean;\r\n  collapsed: boolean;\r\n\r\n  // On-close behavior\r\n  onCloseBehavior: 'continue' | 'default'; // continue where left off or open default tabs\r\n  defaultTabs: string[]; // URLs to open on startup if onCloseBehavior is 'default'\r\n}\r\n\r\nexport interface CustomTheme {\r\n  id: string;\r\n  name: string;\r\n  backgroundColor: string;\r\n  iconBackgroundColor: string;\r\n  iconTextColor: string;\r\n  borderColor: string;\r\n  accentColor: string;\r\n}\r\n\r\nexport interface WorkspaceData {\r\n  workspaces: Workspace[];\r\n  currentWorkspaceId: string;\r\n}\r\n\r\nconst DEFAULT_SETTINGS: WorkspaceSettings = {\r\n  roundedCorners: true,\r\n  marginFromSide: 0,\r\n  marginTop: 0,\r\n  marginBottom: 0,\r\n  width: 52, // Default sidebar width (40-80px range)\r\n  borderRadius: 0, // Default panel border radius\r\n  iconBorderRadius: 25, // Default icon border radius (max)\r\n  position: 'left',\r\n  alignment: 'top',\r\n  backgroundColor: '#252526',\r\n  iconBackgroundColor: '#2d2d2d',\r\n  iconTextColor: '#d4d4d4',\r\n  borderColor: '#3e3e42',\r\n  accentColor: '#007acc',\r\n  mode: 'fixed',\r\n  collapsible: false,\r\n  collapsed: false,\r\n  onCloseBehavior: 'continue',\r\n  defaultTabs: [],\r\n  iconPackId: 'minimalist' // Default to minimalist icon pack\r\n};\r\n\r\nexport class StorageService {\r\n  private static readonly STORAGE_KEY = 'workspaceData';\r\n\r\n  // Get all workspace data\r\n  static async getWorkspaceData(): Promise<WorkspaceData> {\r\n    const result = await chrome.storage.local.get(this.STORAGE_KEY);\r\n    if (!result[this.STORAGE_KEY]) {\r\n      // Initialize with default workspace\r\n      const defaultData: WorkspaceData = {\r\n        workspaces: [{\r\n          id: 'default',\r\n          name: 'Default',\r\n          active: true,\r\n          bookmarks: [],\r\n          openTabs: [],\r\n          closedTabs: [],\r\n          settings: { ...DEFAULT_SETTINGS },\r\n          createdAt: Date.now(),\r\n          updatedAt: Date.now()\r\n        }],\r\n        currentWorkspaceId: 'default'\r\n      };\r\n      await this.saveWorkspaceData(defaultData);\r\n      return defaultData;\r\n    }\r\n    return result[this.STORAGE_KEY] as WorkspaceData;\r\n  }\r\n\r\n  // Save all workspace data\r\n  static async saveWorkspaceData(data: WorkspaceData): Promise<void> {\r\n    await chrome.storage.local.set({ [this.STORAGE_KEY]: data });\r\n  }\r\n\r\n  // Get current workspace\r\n  static async getCurrentWorkspace(): Promise<Workspace> {\r\n    const data = await this.getWorkspaceData();\r\n    const workspace = data.workspaces.find(w => w.id === data.currentWorkspaceId);\r\n    if (!workspace) {\r\n      throw new Error('Current workspace not found');\r\n    }\r\n    return workspace;\r\n  }\r\n\r\n  // Set current workspace\r\n  static async setCurrentWorkspace(workspaceId: string): Promise<void> {\r\n    const data = await this.getWorkspaceData();\r\n    data.workspaces.forEach(w => w.active = w.id === workspaceId);\r\n    data.currentWorkspaceId = workspaceId;\r\n    await this.saveWorkspaceData(data);\r\n  }\r\n\r\n  // Create new workspace\r\n  static async createWorkspace(name: string): Promise<Workspace> {\r\n    const data = await this.getWorkspaceData();\r\n    const newWorkspace: Workspace = {\r\n      id: `workspace-${Date.now()}`,\r\n      name,\r\n      active: false,\r\n      bookmarks: [],\r\n      openTabs: [],\r\n      closedTabs: [],\r\n      settings: { ...DEFAULT_SETTINGS },\r\n      createdAt: Date.now(),\r\n      updatedAt: Date.now()\r\n    };\r\n    data.workspaces.push(newWorkspace);\r\n    await this.saveWorkspaceData(data);\r\n    return newWorkspace;\r\n  }\r\n\r\n  // Update workspace\r\n  static async updateWorkspace(workspaceId: string, updates: Partial<Workspace>): Promise<void> {\r\n    const data = await this.getWorkspaceData();\r\n    const index = data.workspaces.findIndex(w => w.id === workspaceId);\r\n    if (index === -1) throw new Error('Workspace not found');\r\n    \r\n    data.workspaces[index] = {\r\n      ...data.workspaces[index],\r\n      ...updates,\r\n      updatedAt: Date.now()\r\n    };\r\n    await this.saveWorkspaceData(data);\r\n  }\r\n\r\n  // Delete workspace\r\n  static async deleteWorkspace(workspaceId: string): Promise<void> {\r\n    const data = await this.getWorkspaceData();\r\n    if (data.workspaces.length === 1) {\r\n      throw new Error('Cannot delete the last workspace');\r\n    }\r\n    data.workspaces = data.workspaces.filter(w => w.id !== workspaceId);\r\n    if (data.currentWorkspaceId === workspaceId) {\r\n      data.currentWorkspaceId = data.workspaces[0].id;\r\n      data.workspaces[0].active = true;\r\n    }\r\n    await this.saveWorkspaceData(data);\r\n  }\r\n\r\n  // Add bookmark to workspace\r\n  static async addBookmark(workspaceId: string, bookmark: Bookmark): Promise<void> {\r\n    const workspace = (await this.getWorkspaceData()).workspaces.find(w => w.id === workspaceId);\r\n    if (!workspace) throw new Error('Workspace not found');\r\n    \r\n    workspace.bookmarks.push(bookmark);\r\n    await this.updateWorkspace(workspaceId, { bookmarks: workspace.bookmarks });\r\n  }\r\n\r\n  // Update bookmark\r\n  static async updateBookmark(workspaceId: string, bookmarkId: string, updates: Partial<Bookmark>): Promise<void> {\r\n    const workspace = (await this.getWorkspaceData()).workspaces.find(w => w.id === workspaceId);\r\n    if (!workspace) throw new Error('Workspace not found');\r\n    \r\n    const index = workspace.bookmarks.findIndex(b => b.id === bookmarkId);\r\n    if (index === -1) throw new Error('Bookmark not found');\r\n    \r\n    workspace.bookmarks[index] = { ...workspace.bookmarks[index], ...updates };\r\n    await this.updateWorkspace(workspaceId, { bookmarks: workspace.bookmarks });\r\n  }\r\n\r\n  // Delete bookmark\r\n  static async deleteBookmark(workspaceId: string, bookmarkId: string): Promise<void> {\r\n    const workspace = (await this.getWorkspaceData()).workspaces.find(w => w.id === workspaceId);\r\n    if (!workspace) throw new Error('Workspace not found');\r\n    \r\n    workspace.bookmarks = workspace.bookmarks.filter(b => b.id !== bookmarkId);\r\n    await this.updateWorkspace(workspaceId, { bookmarks: workspace.bookmarks });\r\n  }\r\n\r\n  // Reorder bookmarks (for drag-and-drop)\r\n  static async reorderBookmarks(workspaceId: string, bookmarkIds: string[]): Promise<void> {\r\n    const workspace = (await this.getWorkspaceData()).workspaces.find(w => w.id === workspaceId);\r\n    if (!workspace) throw new Error('Workspace not found');\r\n    \r\n    const bookmarkMap = new Map(workspace.bookmarks.map(b => [b.id, b]));\r\n    workspace.bookmarks = bookmarkIds.map((id, index) => ({\r\n      ...bookmarkMap.get(id)!,\r\n      position: index\r\n    }));\r\n    await this.updateWorkspace(workspaceId, { bookmarks: workspace.bookmarks });\r\n  }\r\n\r\n  // Save closed tabs (for remembering on browser close) and which tab was focused.\r\n  // Store only { url, title } so chrome.storage serialization is reliable (full Tab objects can lose .url).\r\n  static async saveClosedTabs(workspaceId: string, tabs: chrome.tabs.Tab[]): Promise<void> {\r\n    const activeTab = tabs.find(t => t.active);\r\n    const activeTabUrl = activeTab?.url && !activeTab.url.startsWith('chrome://') && !activeTab.url.startsWith('chrome-extension://')\r\n      ? activeTab.url\r\n      : undefined;\r\n    const closedTabs: ClosedTabInfo[] = tabs\r\n      .filter(t => t.url && !t.url.startsWith('chrome://') && !t.url.startsWith('chrome-extension://'))\r\n      .map(t => ({ url: t.url!, title: t.title }));\r\n    await this.updateWorkspace(workspaceId, { closedTabs, activeTabUrl: activeTabUrl ?? undefined });\r\n  }\r\n\r\n  // Update workspace settings\r\n  static async updateWorkspaceSettings(workspaceId: string, settings: Partial<WorkspaceSettings>): Promise<void> {\r\n    const workspace = (await this.getWorkspaceData()).workspaces.find(w => w.id === workspaceId);\r\n    if (!workspace) throw new Error('Workspace not found');\r\n    \r\n    workspace.settings = { ...workspace.settings, ...settings };\r\n    await this.updateWorkspace(workspaceId, { settings: workspace.settings });\r\n  }\r\n}\r\n", "// Service Worker for Chrome Extension\r\n// Handles side panel events, workspace tab management, and browser close behavior\r\n\r\nimport { StorageService, Workspace } from './storage';\r\n\r\nconsole.log('Background service worker initialized');\r\n\r\n// Initialize side panel when extension is first loaded\r\nchrome.runtime.onInstalled.addListener(async () => {\r\n  console.log('Extension installed');\r\n  \r\n  // Set up side panel\r\n  chrome.sidePanel.setOptions({\r\n    path: 'dist/sidepanel.html',\r\n    enabled: true\r\n  });\r\n\r\n  // Initialize default workspace if needed\r\n  await StorageService.getWorkspaceData();\r\n});\r\n\r\n// Listen for side panel changes\r\nchrome.sidePanel.onPanelOpened?.addListener(() => {\r\n  console.log('Side panel opened');\r\n});\r\n\r\n// Handle browser close - save tabs for each workspace\r\nchrome.runtime.onSuspend?.addListener(async () => {\r\n  console.log('Extension suspending - saving workspace tabs');\r\n  await saveAllWorkspaceTabs();\r\n});\r\n\r\n// Also listen for browser close via tabs API\r\nchrome.tabs.onRemoved.addListener(async () => {\r\n  // Debounce this to avoid too many writes\r\n  setTimeout(async () => {\r\n    await saveAllWorkspaceTabs();\r\n  }, 1000);\r\n});\r\n\r\n// Save tabs for current workspace (only the last-focused window so we don't mix windows)\r\nasync function saveAllWorkspaceTabs(): Promise<void> {\r\n  try {\r\n    const data = await StorageService.getWorkspaceData();\r\n    if (!data.currentWorkspaceId) return;\r\n    const win = await chrome.windows.getLastFocused({ populate: false }).catch(() => null);\r\n    const tabQuery = win?.id != null ? { windowId: win.id } : {};\r\n    const tabs = await chrome.tabs.query(tabQuery);\r\n    await StorageService.saveClosedTabs(data.currentWorkspaceId, tabs);\r\n  } catch (error) {\r\n    console.error('Error saving workspace tabs:', error);\r\n  }\r\n}\r\n\r\n// Resolve window ID from sender (content script tab) or last-focused window\r\nfunction resolveWindowId(sender: chrome.runtime.MessageSender): Promise<number> {\r\n  if (sender.tab != null && sender.tab.windowId != null) {\r\n    return Promise.resolve(sender.tab.windowId);\r\n  }\r\n  return chrome.windows.getLastFocused({ populate: false })\r\n    .then(win => win?.id ?? 0)\r\n    .catch(() => 0);\r\n}\r\n\r\n// Handle workspace switching - restore tabs if needed\r\nchrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\r\n  if (message.type === 'switchWorkspace') {\r\n    resolveWindowId(sender)\r\n      .then((windowId) => handleWorkspaceSwitch(message.workspaceId, windowId))\r\n      .then(() => sendResponse({ success: true }))\r\n      .catch((error) => {\r\n        console.error('Error switching workspace:', error);\r\n        sendResponse({ success: false, error: error.message });\r\n      });\r\n    return true; // Keep channel open for async response\r\n  }\r\n\r\n  // Content script needs current workspace ID when saving (add workspace/bookmark)\r\n  if (message.type === 'getCurrentWorkspace') {\r\n    StorageService.getWorkspaceData()\r\n      .then((data) => sendResponse({ workspaceId: data.currentWorkspaceId }))\r\n      .catch(() => sendResponse({ workspaceId: 'default' }));\r\n    return true;\r\n  }\r\n\r\n  // Delete workspace (background is source of truth; then replace window tabs if deleted was current)\r\n  if (message.type === 'deleteWorkspace') {\r\n    const workspaceId = message.workspaceId as string;\r\n    StorageService.getWorkspaceData()\r\n      .then((data) => {\r\n        if (!data.workspaces || data.workspaces.length <= 1) {\r\n          sendResponse({ success: false, error: 'Cannot delete the last workspace' });\r\n          return Promise.reject(new Error('abort'));\r\n        }\r\n        const wasCurrent = data.currentWorkspaceId === workspaceId;\r\n        return StorageService.deleteWorkspace(workspaceId).then(() => wasCurrent);\r\n      })\r\n      .then((wasCurrent) => {\r\n        if (!wasCurrent) return;\r\n        return resolveWindowId(sender).then((windowId) =>\r\n          StorageService.getWorkspaceData().then((newData) =>\r\n            replaceWindowTabsWithWorkspaceTabs(newData.currentWorkspaceId, windowId)\r\n          )\r\n        );\r\n      })\r\n      .then(() => sendResponse({ success: true }))\r\n      .catch((err: Error) => {\r\n        if (err?.message !== 'abort') {\r\n          console.error('Error deleting workspace:', err);\r\n          sendResponse({ success: false, error: err?.message ?? 'Unknown error' });\r\n        }\r\n      });\r\n    return true;\r\n  }\r\n});\r\n\r\nasync function handleWorkspaceSwitch(workspaceId: string, windowId?: number): Promise<void> {\r\n  const tabQuery = windowId != null && windowId !== 0 ? { windowId } : {};\r\n\r\n  const data = await StorageService.getWorkspaceData();\r\n  const leavingWorkspaceId = data.currentWorkspaceId;\r\n\r\n  // Single atomic write: save leaving workspace's tabs and set current (avoids races with content script)\r\n  if (leavingWorkspaceId && leavingWorkspaceId !== workspaceId) {\r\n    const allTabs = await chrome.tabs.query(tabQuery);\r\n    const activeTab = allTabs.find(t => t.active);\r\n    const activeTabUrl = activeTab?.url && !activeTab.url.startsWith('chrome://') && !activeTab.url.startsWith('chrome-extension://')\r\n      ? activeTab.url\r\n      : undefined;\r\n    const closedTabs = allTabs\r\n      .filter(t => t.url && !t.url.startsWith('chrome://') && !t.url.startsWith('chrome-extension://'))\r\n      .map(t => ({ url: t.url!, title: t.title }));\r\n    const leaving = data.workspaces.find(w => w.id === leavingWorkspaceId);\r\n    if (leaving) {\r\n      leaving.closedTabs = closedTabs;\r\n      leaving.activeTabUrl = activeTabUrl;\r\n    }\r\n  }\r\n  data.currentWorkspaceId = workspaceId;\r\n  data.workspaces.forEach(w => { w.active = w.id === workspaceId; });\r\n  await StorageService.saveWorkspaceData(data);\r\n\r\n  const workspace = data.workspaces.find(w => w.id === workspaceId);\r\n  if (!workspace) return;\r\n\r\n  const settings = workspace.settings ?? {};\r\n  const onCloseBehavior = settings.onCloseBehavior ?? 'continue';\r\n  const defaultTabs = settings.defaultTabs ?? [];\r\n\r\n  // Always replace this window's tabs with the target workspace's environment (each workspace is its own environment)\r\n  if (onCloseBehavior === 'default' && defaultTabs.length > 0) {\r\n    // Workspace has default URLs: open those, then close current tabs\r\n    const currentTabs = await chrome.tabs.query(tabQuery);\r\n    const tabsToClose = currentTabs\r\n      .filter(tab => tab.id && tab.url && !tab.url.startsWith('chrome://') && !tab.url.startsWith('chrome-extension://'))\r\n      .map(tab => tab.id!);\r\n    const existingUrls = new Set(currentTabs.map(tab => tab.url).filter(Boolean) as string[]);\r\n    for (const url of defaultTabs) {\r\n      if (!existingUrls.has(url)) {\r\n        await chrome.tabs.create({ url, active: false, windowId });\r\n        existingUrls.add(url);\r\n      }\r\n    }\r\n    if (tabsToClose.length > 0) {\r\n      await chrome.tabs.remove(tabsToClose);\r\n    }\r\n  } else {\r\n    // Continue where left off (or empty): show this workspace's saved tabs, or one new tab if none saved\r\n    await replaceWindowTabsWithWorkspaceTabs(workspaceId, windowId, workspace);\r\n  }\r\n}\r\n\r\n/** Replace this window's tabs with the given workspace's saved tabs (or one new tab if workspace has none). */\r\nasync function replaceWindowTabsWithWorkspaceTabs(workspaceId: string, windowId?: number, workspaceFromMemory?: Workspace): Promise<void> {\r\n  const tabQuery = windowId != null && windowId !== 0 ? { windowId } : {};\r\n  const workspace = workspaceFromMemory ?? (await StorageService.getWorkspaceData()).workspaces.find(w => w.id === workspaceId);\r\n  if (!workspace) return;\r\n\r\n  const currentTabs = await chrome.tabs.query(tabQuery);\r\n  const tabsToClose = currentTabs\r\n    .filter(tab => tab.id && tab.url && !tab.url.startsWith('chrome://') && !tab.url.startsWith('chrome-extension://'))\r\n    .map(tab => tab.id!);\r\n\r\n  if (workspace.closedTabs && workspace.closedTabs.length > 0) {\r\n    // Create workspace's saved tabs first, then close old tabs\r\n    const existingUrls = new Set(currentTabs.map(tab => tab.url).filter(Boolean) as string[]);\r\n    let created = 0;\r\n    let activeTabId: number | undefined;\r\n    for (const tab of workspace.closedTabs) {\r\n      if (tab.url && !existingUrls.has(tab.url)) {\r\n        const createdTab = await chrome.tabs.create({ url: tab.url, active: false, windowId });\r\n        created++;\r\n        if (tab.url === workspace.activeTabUrl) {\r\n          activeTabId = createdTab.id;\r\n        }\r\n      }\r\n    }\r\n    // Only close old tabs if we created at least one new tab, so we never leave the window with 0 tabs\r\n    if (tabsToClose.length > 0 && created > 0) {\r\n      await chrome.tabs.remove(tabsToClose);\r\n    }\r\n    // Focus the tab that was last active in this workspace (so it's focused + loaded when switching back)\r\n    if (activeTabId != null) {\r\n      await chrome.tabs.update(activeTabId, { active: true });\r\n      if (windowId != null) {\r\n        await chrome.windows.update(windowId, { focused: true });\r\n      }\r\n    } else if (workspace.activeTabUrl && windowId != null) {\r\n      // Active tab was already open (e.g. same URL); find it after close and focus\r\n      const tabsInWindow = await chrome.tabs.query({ windowId });\r\n      const tabToFocus = tabsInWindow.find(t => t.url === workspace.activeTabUrl);\r\n      if (tabToFocus?.id) {\r\n        await chrome.tabs.update(tabToFocus.id, { active: true });\r\n        await chrome.windows.update(windowId, { focused: true });\r\n      }\r\n    }\r\n  } else {\r\n    // Workspace has no saved tabs: one new tab (newTabUrl or google.com), then close old\r\n    const data = await chrome.storage.local.get('newTabUrl');\r\n    const raw = (data?.newTabUrl != null && String(data.newTabUrl).trim()) ? String(data.newTabUrl).trim() : 'https://www.google.com/';\r\n    const url = /^https?:\\/\\//i.test(raw) ? raw : 'https://' + raw;\r\n    await chrome.tabs.create({ url, active: true, windowId });\r\n    if (tabsToClose.length > 0) {\r\n      await chrome.tabs.remove(tabsToClose);\r\n    }\r\n  }\r\n}\r\n\r\nasync function restoreWorkspaceTabs(workspaceId: string, clearExisting: boolean = false, windowId?: number): Promise<void> {\r\n  const workspace = (await StorageService.getWorkspaceData()).workspaces.find(w => w.id === workspaceId);\r\n  if (!workspace || !workspace.closedTabs?.length) return;\r\n\r\n  const tabQuery = windowId != null && windowId !== 0 ? { windowId } : {};\r\n  const currentTabs = await chrome.tabs.query(tabQuery);\r\n\r\n  if (clearExisting && currentTabs.length > 0) {\r\n    const tabsToClose = currentTabs\r\n      .filter(tab => tab.id && tab.url && !tab.url.startsWith('chrome://') && !tab.url.startsWith('chrome-extension://'))\r\n      .map(tab => tab.id!);\r\n\r\n    const existingUrls = new Set(currentTabs.map(tab => tab.url).filter(Boolean) as string[]);\r\n\r\n    // Create new tabs FIRST so the window never has 0 tabs (avoids browser/window closing)\r\n    let created = 0;\r\n    for (const tab of workspace.closedTabs) {\r\n      if (tab.url && !existingUrls.has(tab.url)) {\r\n        await chrome.tabs.create({ url: tab.url, active: false, windowId });\r\n        existingUrls.add(tab.url);\r\n        created++;\r\n      }\r\n    }\r\n\r\n    // Only close old tabs if we created at least one new one, so we never leave the window with 0 tabs\r\n    if (tabsToClose.length > 0 && created > 0) {\r\n      await chrome.tabs.remove(tabsToClose);\r\n    }\r\n  } else {\r\n    const remainingTabs = await chrome.tabs.query(tabQuery);\r\n    const existingUrls = new Set(remainingTabs.map(tab => tab.url).filter(Boolean) as string[]);\r\n    for (const tab of workspace.closedTabs) {\r\n      if (tab.url && !existingUrls.has(tab.url)) {\r\n        await chrome.tabs.create({ url: tab.url, active: false, windowId });\r\n        existingUrls.add(tab.url);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n// Handle extension startup - restore workspace state (only in the current window)\r\nchrome.runtime.onStartup.addListener(async () => {\r\n  console.log('Extension startup - restoring workspace state');\r\n  try {\r\n    const workspace = await StorageService.getCurrentWorkspace();\r\n    const win = await chrome.windows.getCurrent({ populate: false });\r\n    const windowId = win?.id;\r\n    const currentTabs = windowId != null ? await chrome.tabs.query({ windowId }) : await chrome.tabs.query({});\r\n    const settings = workspace.settings ?? {};\r\n    const onCloseBehavior = settings.onCloseBehavior ?? 'continue';\r\n    const defaultTabs = settings.defaultTabs ?? [];\r\n\r\n    if (onCloseBehavior === 'continue' && workspace.closedTabs?.length > 0) {\r\n      if (windowId != null) {\r\n        await restoreWorkspaceTabs(workspace.id, true, windowId);\r\n      } else {\r\n        await restoreWorkspaceTabs(workspace.id, true);\r\n      }\r\n    } else if (onCloseBehavior === 'default' && defaultTabs.length > 0) {\r\n      const existingUrls = new Set(currentTabs.map(tab => tab.url).filter(Boolean) as string[]);\r\n      for (const url of defaultTabs) {\r\n        if (!existingUrls.has(url)) {\r\n          await chrome.tabs.create({ url, active: false, windowId });\r\n          existingUrls.add(url);\r\n        }\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.error('Error restoring workspace on startup:', error);\r\n  }\r\n});\r\n"],
  "mappings": "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",
  "names": []
}
